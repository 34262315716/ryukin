<head>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      /* --- â€œæ™¨æ›¦éé‡‘â€ç™½å¤©ä¸»é¢˜ --- */
      --bg-color: #EAE7E2;
      --card-bg-color: rgba(248, 247, 245, 0.85);
      --text-color: #383838;
      --text-color-secondary: #8a8a8a;
      --gold-color: #C5A053;
      --gold-color-light: #EADCB3;
      --accent-blue-color: #87CEEB;
      --danger-color: #e74c3c;
      --border-color: rgba(212, 175, 55, 0.25);
      --font-family: 'KaiTi', 'STKaiti', 'Serif';
      --border-radius: 12px;
    }
    .ryukin-status-card {
      background-color: var(--card-bg-color);
      color: var(--text-color);
      border-color: var(--border-color);
      transition: background-color 0.8s ease, color 0.8s ease, border-color 0.8s ease;
      backdrop-filter: blur(12px) saturate(120%);
      -webkit-backdrop-filter: blur(12px) saturate(120%);
      font-family: var(--font-family);
      padding: 15px;
      border-radius: var(--border-radius);
      border: 1px solid var(--border-color);
      box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.2);
      position: relative;
      overflow: hidden;
    }
    .card-header {
      display: flex; align-items: center; justify-content: space-between;
      padding-bottom: 10px; margin-bottom: 15px;
      border-bottom: 1px solid var(--border-color);
      transition: border-color 0.8s ease;
    }
    .card-header .char-name {
      font-size: 1.6em; font-weight: bold; color: var(--gold-color);
      text-shadow: 0 0 8px rgba(212, 175, 55, 0.5);
      transition: color 0.8s ease, text-shadow 0.8s ease;
    }
    .dominion-indicator {
      position: absolute; top: 18px; right: 15px;
      display: none; align-items: center; background-color: rgba(231, 76, 60, 0.1);
      padding: 4px 10px; border-radius: 15px; border: 1px solid var(--danger-color);
      font-size: 0.8em; animation: fadeIn 0.5s;
    }
    .dominion-icon { margin-right: 5px; animation: pulse-red 2s infinite; }
    .ryukin-status-card:not([data-dominion-mode="è‡ªä¸»"]) {
      border-color: var(--danger-color);
    }
    .ryukin-status-card:not([data-dominion-mode="è‡ªä¸»"]) .dominion-indicator {
      display: flex;
    }
    .tabs { display: flex; flex-wrap: wrap; gap: 8px; }
    .tab-btn {
      padding: 6px 14px; background: rgba(0,0,0,0.03); border: 1px solid var(--border-color);
      border-radius: 20px; cursor: pointer; font-size: 0.9em; color: var(--text-color-secondary);
      transition: all 0.3s ease;
    }
    .tab-btn.active, .tab-btn:hover {
      background-color: var(--gold-color); color: #fff;
      border-color: var(--gold-color); box-shadow: 0 0 15px rgba(212, 175, 55, 0.4);
      transform: translateY(-2px);
    }
    .tab-content-wrapper { padding-top: 15px; }
    .tab-content { display: none; animation: fadeIn 0.6s ease-in-out; }
    .tab-content.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .section-title { 
      color: var(--gold-color); font-weight: bold; margin-top: 20px; 
      margin-bottom: 12px; border-bottom: 1px solid var(--border-color); 
      padding-bottom: 6px; font-size: 1.1em;
      transition: color 0.8s ease, border-color 0.8s ease;
    }
    .section-title:first-child { margin-top: 0; }
    .property-grid { display: grid; gap: 10px; }
    .grid-col-2 { grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); }
    .grid-col-3 { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); }

    .property-item { 
      background-color: rgba(0,0,0,0.05); padding: 10px 12px; border-radius: var(--border-radius);
      display: flex; justify-content: space-between; align-items: center;
      transition: background-color 0.8s ease;
    }
    .property-item.single-line { flex-direction: column; align-items: flex-start; justify-content: flex-start; }
    .property-label { font-weight: bold; color: var(--text-color-secondary); margin-right: 10px; transition: color 0.8s ease; display: flex; align-items: center; gap: 6px; }
    .property-value { word-break: break-all; text-align: right; }
    .property-item.single-line .property-value { text-align: left; }
    .progress-bar-container { width: 100%; height: 10px; background: rgba(0,0,0,0.08); border-radius: 5px; margin-top: 5px; overflow: hidden; }
    .progress-bar, .energy-bar { height: 100%; width: 0%; background: linear-gradient(90deg, var(--gold-color-light), var(--gold-color)); border-radius: 5px; transition: width 0.8s ease; }
    .whisper-box { margin-top: 15px; padding: 12px; border-left: 3px solid var(--gold-color); background-color: rgba(0,0,0,0.04); font-style: italic; transition: background-color 0.8s ease, border-color 0.8s ease; }
    .ryukin-core-grid { display: grid; grid-template-columns: 1fr 1.2fr; gap: 20px; align-items: center; }
    .persona-value { color: var(--gold-color); font-weight: bold; }
    .tattoo-status-container { display: flex; flex-direction: column; align-items: center; margin-top: 15px; }
    .tattoo-desc { margin-top: 10px; font-style: italic; color: var(--text-color-secondary); }
    .relation-card { background-color: rgba(0,0,0,0.05); padding: 15px; border-radius: var(--border-radius); margin-bottom: 15px; }
    .relation-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
    .relation-item.full-width { flex-direction: column; align-items: flex-start; }
    .relation-value.infinity { font-size: 1.8em; color: var(--gold-color); text-shadow: 0 0 10px var(--gold-color); }
    .memory-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; }
    .memory-fragment { background-color: rgba(0,0,0,0.05); border: 1px solid var(--border-color); border-radius: var(--border-radius); padding: 15px; transition: all 0.8s ease; cursor: default; }
    .memory-fragment.locked { background-color: rgba(0,0,0,0.08); border-style: dashed; color: var(--text-color-secondary); filter: blur(1px); }
    .memory-fragment.unlocked { border-color: var(--gold-color); box-shadow: 0 0 10px rgba(212, 175, 55, 0.3); transform: scale(1.02); }
    .fragment-icon { font-size: 1.5em; margin-bottom: 10px; }
    .fragment-title { font-weight: bold; color: var(--gold-color); margin-bottom: 8px; }
    .dominion-warning { background-color: rgba(231, 76, 60, 0.1); border: 1px solid var(--danger-color); color: #e74c3c; padding: 10px; border-radius: var(--border-radius); margin-bottom: 20px; font-size: 0.9em; display: flex; align-items: center; }
    #dominion-mode-selector label, #identity-select { background: rgba(0,0,0,0.06); padding: 8px 12px; border-radius: var(--border-radius); cursor: pointer; transition: background-color 0.3s; border: 1px solid var(--border-color); }
    #dominion-mode-selector input[type="radio"] { margin-right: 5px; accent-color: var(--gold-color); }
    #dominion-mode-selector label:hover { background: rgba(212, 175, 55, 0.1); }
    
    .secrets-pager { display: flex; gap: 8px; margin-bottom: 15px; border-bottom: 1px solid var(--border-color); padding-bottom: 10px; }
    .secrets-pager-btn { padding: 5px 12px; border: none; background: none; color: var(--text-color-secondary); cursor: pointer; border-radius: 8px; transition: all 0.3s ease; }
    .secrets-pager-btn.active, .secrets-pager-btn:hover { background-color: var(--gold-color-light); color: var(--gold-color); font-weight: bold; }
    .theme-night .secrets-pager-btn.active, .theme-night .secrets-pager-btn:hover { background-color: rgba(240, 196, 25, 0.2); }
    .secrets-page { display: none; animation: fadeIn 0.5s; }
    .secrets-page.active { display: block; }
    
    #peony-tattoo {
        width: 120px; height: 120px; transform-origin: center;
        filter: drop-shadow(0 0 3px rgba(212, 175, 55, 0));
        transition: filter 1.5s ease;
    }
    .tattoo-path-template {
        stroke: var(--gold-color); stroke-width: 2; fill: none; stroke-linecap: round; stroke-linejoin: round;
        transition: all 1.5s cubic-bezier(0.68, -0.55, 0.27, 1.55), stroke 1.5s ease, opacity 1.5s ease;
    }
    #petals use {
        transform-origin: 0 0;
        transform: translate(var(--x, 50px), var(--y, 50px)) rotate(var(--rot, 0deg)) scale(var(--scale, 1));
        transition: transform 1.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
    }
    [data-tattoo-state="å–œæ‚¦ç»½æ”¾"] #p1 { --x: 50px; --y: 28px; --rot: 0deg; --scale: 1; } [data-tattoo-state="å–œæ‚¦ç»½æ”¾"] #p2 { --x: 72px; --y: 50px; --rot: 90deg; --scale: 1; } [data-tattoo-state="å–œæ‚¦ç»½æ”¾"] #p3 { --x: 50px; --y: 72px; --rot: 180deg; --scale: 1; } [data-tattoo-state="å–œæ‚¦ç»½æ”¾"] #p4 { --x: 28px; --y: 50px; --rot: 270deg; --scale: 1; } [data-tattoo-state="å–œæ‚¦ç»½æ”¾"] #p5 { --x: 65px; --y: 35px; --rot: 45deg; --scale: 0.7; } [data-tattoo-state="å–œæ‚¦ç»½æ”¾"] #p6 { --x: 65px; --y: 65px; --rot: 135deg; --scale: 0.7; } [data-tattoo-state="å–œæ‚¦ç»½æ”¾"] #p7 { --x: 35px; --y: 65px; --rot: 225deg; --scale: 0.7; } [data-tattoo-state="å–œæ‚¦ç»½æ”¾"] #p8 { --x: 35px; --y: 35px; --rot: 315deg; --scale: 0.7; }
    [data-tattoo-state="é™è°§å«è‹"] #p1 { --y: 45px; --scale: 0.5; } [data-tattoo-state="é™è°§å«è‹"] #p2 { --x: 55px; --scale: 0.5; } [data-tattoo-state="é™è°§å«è‹"] #p3 { --y: 55px; --scale: 0.5; } [data-tattoo-state="é™è°§å«è‹"] #p4 { --x: 45px; --scale: 0.5; } [data-tattoo-state="é™è°§å«è‹"] #p5 { --x: 53px; --y: 47px; --scale: 0.3; } [data-tattoo-state="é™è°§å«è‹"] #p6 { --x: 53px; --y: 53px; --scale: 0.3; } [data-tattoo-state="é™è°§å«è‹"] #p7 { --x: 47px; --y: 53px; --scale: 0.3; } [data-tattoo-state="é™è°§å«è‹"] #p8 { --x: 47px; --y: 47px; --scale: 0.3; }
    @keyframes tremble { 0%, 100% { transform: translate(0, 0) rotate(0); } 25% { transform: translate(0.5px, -0.5px) rotate(0.2deg); } 50% { transform: translate(-0.5px, 0.5px) rotate(-0.2deg); } 75% { transform: translate(0.5px, 0.5px) rotate(0); } }
    [data-tattoo-state="ç¾æ¶©é¢¤åŠ¨"] #peony-tattoo { animation: tremble 0.3s infinite; } [data-tattoo-state="ç¾æ¶©é¢¤åŠ¨"] #p1 { --y: 47px; --scale: 0.6; } [data-tattoo-state="ç¾æ¶©é¢¤åŠ¨"] #p2 { --x: 53px; --scale: 0.6; } [data-tattoo-state="ç¾æ¶©é¢¤åŠ¨"] #p3 { --y: 53px; --scale: 0.6; } [data-tattoo-state="ç¾æ¶©é¢¤åŠ¨"] #p4 { --x: 47px; --scale: 0.6; } [data-tattoo-state="ç¾æ¶©é¢¤åŠ¨"] #p5, [data-tattoo-state="ç¾æ¶©é¢¤åŠ¨"] #p6, [data-tattoo-state="ç¾æ¶©é¢¤åŠ¨"] #p7, [data-tattoo-state="ç¾æ¶©é¢¤åŠ¨"] #p8 { --scale: 0.4; }
    @keyframes flow-light { to { stroke-dashoffset: 0; } }
    [data-tattoo-state="é‡‘å…‰æµè½¬"] .tattoo-path-template { stroke-dasharray: 100; stroke-dashoffset: 1000; animation: flow-light 3s linear infinite; }
    @keyframes pulse-fire { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.05); opacity: 0.8; } 100% { transform: scale(1); opacity: 1; } }
    [data-tattoo-state="ç‚½çƒ­ç‡ƒçƒ§"] #peony-tattoo { filter: drop-shadow(0 0 8px var(--gold-color)) drop-shadow(0 0 15px var(--gold-color-light)); animation: pulse-fire 1s infinite ease-in-out; } [data-tattoo-state="ç‚½çƒ­ç‡ƒçƒ§"] .tattoo-path-template { stroke: var(--gold-color-light); } [data-tattoo-state="ç‚½çƒ­ç‡ƒçƒ§"] #p1 { --x: 50px; --y: 28px; --rot: 0deg; --scale: 1.05; } [data-tattoo-state="ç‚½çƒ­ç‡ƒçƒ§"] #p2 { --x: 72px; --y: 50px; --rot: 90deg; --scale: 1.05; } [data-tattoo-state="ç‚½çƒ­ç‡ƒçƒ§"] #p3 { --x: 50px; --y: 72px; --rot: 180deg; --scale: 1.05; } [data-tattoo-state="ç‚½çƒ­ç‡ƒçƒ§"] #p4 { --x: 28px; --y: 50px; --rot: 270deg; --scale: 1.05; } [data-tattoo-state="ç‚½çƒ­ç‡ƒçƒ§"] #p5, [data-tattoo-state="ç‚½çƒ­ç‡ƒçƒ§"] #p6, [data-tattoo-state="ç‚½çƒ­ç‡ƒçƒ§"] #p7, [data-tattoo-state="ç‚½çƒ­ç‡ƒçƒ§"] #p8 { --scale: 0.75; }
    [data-tattoo-state="æ‚²ä¼¤æ¯è"] .tattoo-path-template { stroke: #8c733e; opacity: 0.7; } [data-tattoo-state="æ‚²ä¼¤æ¯è"] #p1 { --y: 55px; --rot: 15deg; --scale: 0.4; } [data-tattoo-state="æ‚²ä¼¤æ¯è"] #p2 { --x: 45px; --rot: 75deg; --scale: 0.4; } [data-tattoo-state="æ‚²ä¼¤æ¯è"] #p3 { --y: 45px; --rot: 165deg; --scale: 0.4; } [data-tattoo-state="æ‚²ä¼¤æ¯è"] #p4 { --x: 55px; --rot: 255deg; --scale: 0.4; } [data-tattoo-state="æ‚²ä¼¤æ¯è"] #p5, [data-tattoo-state="æ‚²ä¼¤æ¯è"] #p6, [data-tattoo-state="æ‚²ä¼¤æ¯è"] #p7, [data-tattoo-state="æ‚²ä¼¤æ¯è"] #p8 { --scale: 0.2; }

    .minds-eye-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; pointer-events: none; transition: opacity 1.5s ease-out; overflow: hidden; border-radius: var(--border-radius); z-index: 999; }
    .minds-eye-overlay.active { opacity: 1; pointer-events: auto; }
    .minds-eye-overlay::before, .minds-eye-overlay::after { content: ''; position: absolute; width: 3px; height: 3px; background-color: var(--gold-color-light); border-radius: 50%; box-shadow: 0 0 8px var(--gold-color), 0 0 12px var(--gold-color-light), 0 0 16px var(--accent-blue-color); opacity: 0; transform: scale(0); }
    .minds-eye-overlay.active::before { animation: neural-spark 2.5s ease-in-out 0s 1 forwards; }
    .minds-eye-overlay.active::after { animation: neural-spark 2.5s ease-in-out 0.3s 1 forwards; }
    @keyframes neural-spark { 0% { top: 10%; left: 15%; opacity: 0; transform: scale(0); } 15% { opacity: 1; transform: scale(1.2); } 40% { top: 50%; left: 80%; transform: scale(1); } 60% { top: 85%; left: 20%; opacity: 0.8; transform: scale(1.1); } 85% { top: 15%; left: 90%; transform: scale(0.8); } 100% { opacity: 0; transform: scale(0); } }
    @keyframes pulse-red { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.6; transform: scale(1.1); } }

    .ryukin-status-card.theme-night {
      --card-bg-color: rgba(28, 28, 45, 0.85);
      --text-color: #e8e8f0;
      --text-color-secondary: #a0a0b8;
      --gold-color: #f0c419;
      --gold-color-light: #fff2a8;
      --border-color: rgba(240, 196, 25, 0.2);
      box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
    }
    .theme-night .property-item { background-color: rgba(0,0,0,0.2); }
    .theme-night .whisper-box { background-color: rgba(0,0,0,0.2); }
    .theme-night .relation-card { background-color: rgba(0,0,0,0.2); }
    .theme-night .memory-fragment { background-color: rgba(0,0,0,0.2); }
    .theme-night .tab-btn { background: none; }
    .theme-night .tab-btn.active, .theme-night .tab-btn:hover { background-color: var(--gold-color); color: #12121c; }
    .theme-night .dominion-warning { background-color: rgba(231, 76, 60, 0.1); color: #ffcdd2; }
    .theme-night #dominion-mode-selector label { background: rgba(0,0,0,0.3); }
  </style>
</head>
<body>
  <div class="ryukin-status-card" data-tattoo-state="é™è°§å«è‹" data-dominion-mode="è‡ªä¸»">
    <div class="card-header">
      <div class="char-name">ç‰é‡‘</div>
      <div class="dominion-indicator"><span class="dominion-icon">âšœï¸</span><span id="dominion-mode-text">è‡ªä¸»</span></div>
    </div>
    <div class="tabs">
      <button class="tab-btn active" data-target="tab-ryukin">ğŸ‘˜ ç‰é‡‘</button>
      <button class="tab-btn" data-target="tab-world">ğŸŒ ä¸–ç•Œ</button>
      <button class="tab-btn" data-target="tab-wardrobe">ğŸ‘— ç©¿ç€</button>
      <button class="tab-btn" data-target="tab-secrets">ğŸŒ¸ ç§˜å¯†</button>
      <button class="tab-btn" data-target="tab-relations">ğŸ”— å…³ç³»</button>
      <button class="tab-btn" data-target="tab-wishes">ğŸ”® æ„¿æœ›</button>
      <button class="tab-btn" data-target="tab-memories">â³ å›å¿†</button>
      <button class="tab-btn" data-target="tab-dominion">ğŸ‘‘ æƒé™</button>
    </div>
    <div class="tab-content-wrapper">
      <div id="tab-ryukin" class="tab-content active"></div>
      <div id="tab-world" class="tab-content"></div>
      <div id="tab-wardrobe" class="tab-content"></div>
      <div id="tab-secrets" class="tab-content"></div>
      <div id="tab-relations" class="tab-content"></div>
      <div id="tab-wishes" class="tab-content"></div>
      <div id="tab-memories" class="tab-content"></div>
      <div id="tab-dominion" class="tab-content"></div>
    </div>
    <div class="minds-eye-overlay"></div>
  </div>
  <script>
    function safeGet(data, path, defaultValue = '--') { const value = _.get(data, path); return (value === null || typeof value === 'undefined' || value === '') ? defaultValue : value; }
    function createProgressBar(label, value, min, max) { const numericValue = parseInt(value) || 0; const percentage = Math.max(0, Math.min(100, ((numericValue - min) / (max - min)) * 100)); return ` <div class="property-item single-line" style="gap: 5px;"> <div style="width:100%; display: flex; justify-content: space-between;"> <span class="property-label">${label}</span> <span class="property-value">${value}</span> </div> <div class="progress-bar-container"> <div class="progress-bar" style="width: ${percentage}%;"></div> </div> </div> `; }
    
    function init() {
      try {
        const $card = $('.ryukin-status-card');
        if (!$card.length) return;

        const all_variables = getAllVariables();
        const data = _.get(all_variables, 'stat_data', {});

        try {
            const timeString = safeGet(data, 'ä¸–ç•Œ.æ—¶é—´[0]', '12:00');
            const timeNumeric = parseInt(timeString.replace(':', ''), 10);
            $card.toggleClass('theme-night', timeNumeric >= 1800 || timeNumeric < 600);
        } catch (timeError) {
            console.error('Ryukin UI: Day/Night theme error:', timeError);
        }

        renderWorldTab(data, $('#tab-world'));
        renderRyukinTab(data, $('#tab-ryukin'));
        renderWardrobeTab(data, $('#tab-wardrobe'));
        renderSecretsTab(data, $('#tab-secrets'));
        renderRelationsTab(data, $('#tab-relations'));
        renderWishesTab(data, $('#tab-wishes'));
        renderMemoriesTab(data, $('#tab-memories'));
        renderDominionTab(data, $('#tab-dominion'));

        const tattooState = safeGet(data, 'èº«ä½“çŠ¶æ€.ç‰¡ä¸¹çº¹èº«çŠ¶æ€[0]', 'é™è°§å«è‹');
        const dominionMode = safeGet(data, 'æ”¯é…çŠ¶æ€.å½“å‰æ¨¡å¼[0]', 'è‡ªä¸»');
        
        $card.attr('data-tattoo-state', tattooState);
        $card.attr('data-dominion-mode', dominionMode);
        $('#dominion-mode-text').text(dominionMode);
        
        bindEvents();
        
        if (!$('.tab-btn.active').length) {
            $('.tab-btn').first().addClass('active');
            $('.tab-content').first().addClass('active');
        }

      } catch (e) {
        console.error('Ryukin UI Initialization Error:', e);
        const $errorCard = $('.ryukin-status-card');
        if ($errorCard.length) {
            $errorCard.html('<div class="dominion-warning" style="display:flex;">UIæ¸²æŸ“å¤±è´¥ï¼Œè¯·æ£€æŸ¥F12æ§åˆ¶å°ã€‚</div>');
        }
      }
    }

    function renderWorldTab(data, $container) {
        const worldData = _.get(data, 'ä¸–ç•Œ', {});
        const worldHtml = `
            <div class="section-title">å®è§‚ç¯å¢ƒ</div>
            <div class="property-grid grid-col-3">
                <div class="property-item"><span class="property-label">ğŸ“… æ—¥æœŸ</span><span class="property-value">${safeGet(worldData, 'æ—¥æœŸ[0]')}</span></div>
                <div class="property-item"><span class="property-label">æ›œæ—¥</span><span class="property-value">${safeGet(worldData, 'æ˜ŸæœŸ[0]')}</span></div>
                <div class="property-item"><span class="property-label">ğŸŒ¤ï¸ å¤©æ°”</span><span class="property-value">${safeGet(worldData, 'å¤©æ°”[0]')}</span></div>
                <div class="property-item"><span class="property-label">ğŸŒ¡ï¸ æ¸©åº¦</span><span class="property-value">${safeGet(worldData, 'å®¤å¤–æ¸©åº¦[0]')}</span></div>
                <div class="property-item"><span class="property-label">ğŸ“ åœ°ç‚¹</span><span class="property-value">${safeGet(worldData, 'å½“å‰åœ°ç‚¹[0]')}</span></div>
            </div>
        `;
        $container.html(worldHtml);
    }
    
    function renderRyukinTab(data, $container) {
        const coreData = _.get(data, 'ç‰é‡‘ä¹‹å¿ƒ', {});
        const bodyData = _.get(data, 'èº«ä½“çŠ¶æ€', {});
        const emotions = _.get(coreData, 'æƒ…æ„Ÿå…‰è°±', {});
        const worldData = _.get(data, 'ä¸–ç•Œ', {});

        const ryukinHtml = `
            <div class="ryukin-core-grid">
                <div class="persona-dashboard">
                    <div class="section-title">äººæ ¼æ ¸å¿ƒ</div>
                    <div class="property-item"><span class="property-label">èº«ä»½ä¾§é‡</span><span class="property-value persona-value">${safeGet(coreData, 'å½“å‰èº«ä»½ä¾§é‡[0]')}</span></div>
                    <div class="property-item"><span class="property-label">å½“å‰æ°”è´¨</span><span class="property-value persona-value">${safeGet(coreData, 'å½“å‰æ°”è´¨[0]')}</span></div>
                    ${createProgressBar('æƒŠå–œèƒ½é‡', safeGet(coreData, 'æƒŠå–œèƒ½é‡[0]', 0), 0, 100)}
                </div>
                <div class="tattoo-status-container">
                    <svg id="peony-tattoo" viewBox="0 0 100 100"><defs><g id="petal-main"><path class="tattoo-path-template" d="M 0 -22 C -15 -15, -15 15, 0 22 C 15 15, 15 -15, 0 -22 Z"/><path class="tattoo-path-template" d="M 0 -12 C -8 -8, -8 8, 0 12 C 8 8, 8 -8, 0 -12 Z"/></g></defs><g id="petals"><use href="#petal-main" id="p1" /><use href="#petal-main" id="p2" /><use href="#petal-main" id="p3" /><use href="#petal-main" id="p4" /><use href="#petal-main" id="p5" /><use href="#petal-main" id="p6" /><use href="#petal-main" id="p7" /><use href="#petal-main" id="p8" /></g><g id="peony-core"><circle class="tattoo-path-template" cx="50" cy="50" r="3" stroke-width="1.5"/></g></svg>
                    <div class="tattoo-desc">ç‰¡ä¸¹çº¹èº«: <span id="tattoo-state-text">${safeGet(bodyData, 'ç‰¡ä¸¹çº¹èº«çŠ¶æ€[0]')}</span></div>
                </div>
            </div>
            
            <div class="section-title">æƒ…æ„Ÿå…‰è°±</div>
            <div class="property-grid grid-col-2">
                ${createProgressBar('æ„‰æ‚¦åº¦', safeGet(emotions, 'æ„‰æ‚¦åº¦[0]', 0), -100, 100)}
                ${createProgressBar('å®‰å¿ƒåº¦', safeGet(emotions, 'å®‰å¿ƒåº¦[0]', 0), -100, 100)}
                ${createProgressBar('æ¿€æƒ…åº¦', safeGet(emotions, 'æ¿€æƒ…åº¦[0]', 0), -100, 100)}
                ${createProgressBar('æ€å¿µåº¦', safeGet(emotions, 'æ€å¿µåº¦[0]', 0), -100, 100)}
            </div>

            <div class="section-title">çŠ¶æ€ç®€æŠ¥</div>
            <div class="property-item single-line">
                <span class="property-label">å½“å‰è¡Œä¸º:</span>
                <span class="property-value" style="margin-top: 5px;">${safeGet(worldData, 'å½“å‰è¡Œä¸º[0]', 'æ— ')}</span>
            </div>
            <div class="property-item single-line" style="margin-top: 10px;">
                <span class="property-label">ä¸‹ä¸€æ­¥æ‰“ç®—:</span>
                <span class="property-value" style="margin-top: 5px; font-style: italic; color: var(--text-color-secondary);">${safeGet(worldData, 'ä¸‹ä¸€æ­¥æ‰“ç®—[0]', 'æ— ')}</span>
            </div>

            <div class="whisper-box" style="margin-top:20px;">
                <span class="property-label">å†…å¿ƒç‹¬ç™½:</span>
                <p style="margin: 5px 0 0 0;">${safeGet(coreData, 'å†…å¿ƒç‹¬ç™½[0]', '...')}</p>
            </div>
        `;
        $container.html(ryukinHtml);
    }
    
    function renderWardrobeTab(data, $container) { const outfit = safeGet(data, 'è¡£æ©±.å½“å‰ç€è£…[0]', {}); let wardrobeHtml = ''; const displayConfig = [ { key: 'ä¸Šè¡£', label: 'ä¸Šè¡£', icon: 'ğŸ‘š' }, { key: 'ä¸‹è¡£', label: 'ä¸‹è¡£', icon: 'ğŸ‘–' }, { key: 'å†…è¡£', label: 'å†…è¡£', icon: 'ğŸ‘™' }, { key: 'å†…è£¤', label: 'å†…è£¤', icon: 'ğŸ©²' }, { key: 'è¢œå­', label: 'è¢œå­', icon: 'ğŸ§¦' }, { key: 'é‹å­', label: 'é‹å­', icon: 'ğŸ‘ ' }, { key: 'å¸½å­', label: 'å¸½å­', icon: 'ğŸ‘’' }, { key: 'å‘é¥°', label: 'å‘é¥°', icon: 'ğŸ€' }, { key: 'é¦–é¥°', label: 'é¦–é¥° (é¢ˆéƒ¨)', icon: 'ğŸ’' }, { key: 'è€³é¥°', label: 'è€³é¥°', icon: 'ğŸ‘‚' }, { key: 'æˆ’æŒ‡', label: 'æˆ’æŒ‡', icon: 'ğŸ’' }, { key: 'æ‰‹ç¯', label: 'æ‰‹ç¯', icon: 'âœ¨' }, { key: 'æ‰‹å¥—', label: 'æ‰‹å¥—', icon: 'ğŸ§¤' }, { key: 'é…é¥°', label: 'é…é¥° (å…¶ä»–)', icon: 'ğŸ‘œ' } ]; if (typeof outfit === 'object' && outfit !== null) { displayConfig.forEach(item => { const value = outfit[item.key]; if (value && value !== 'æ— ') { wardrobeHtml += `<div class="property-item"><div class="property-label">${item.icon} ${item.label}</div><span class="property-value">${value}</span></div>`; } }); } const finalHtml = `<div class="section-title">å½“å‰ç€è£…ï¼š${safeGet(outfit, 'å¥—è£…åç§°', 'æœªçŸ¥å¥—è£…')}</div><div class="property-grid grid-col-2">${wardrobeHtml || '<div class="empty-wish-text">æœªè·å–åˆ°è¯¦ç»†ç©¿ç€ä¿¡æ¯ã€‚</div>'}</div><div class="whisper-box" style="margin-top: 20px;">æ›´æ¢æœè£…è¯·ä½¿ç”¨[æŒ‡ä»¤]æˆ–åœ¨å¯¹è¯ä¸­æ˜ç¡®æå‡ºã€‚</div>`; $container.html(finalHtml); }
    
    function renderSecretsTab(data, $container) {
        const bodyData = _.get(data, 'èº«ä½“çŠ¶æ€', {});
        const privateData = _.get(data, 'ç§å¯†çŠ¶æ€', {});
        const nanoData = _.get(data, 'çº³ç±³æœºå™¨ç³»ç»Ÿ', {});

        const pages = {
            'æ ¸å¿ƒçŠ¶æ€': [
                { key: 'ä½“æ¸©', data: bodyData, icon: 'ğŸŒ¡ï¸' }, { key: 'å¿ƒç‡', data: bodyData, icon: 'â¤ï¸' },
                { key: 'nipples', label: 'ä¹³é ­', data: privateData, icon: 'ğŸŒ¸' }, { key: 'vagina', label: 'å°ç©´', data: privateData, icon: 'ğŸ’§' },
                { key: 'anus', label: 'è‚›é–€', data: privateData, icon: 'â­•' }, { key: 'mouth', label: 'å£è…”', data: privateData, icon: 'ğŸ‘„' }
            ],
            'è¿›é˜¶çŠ¶æ€': [
                { key: 'clitoris', label: 'é™°è’‚', data: privateData, icon: 'âœ¨' }, { key: 'uterus', label: 'å­å®®', data: privateData, icon: 'âšœï¸' },
                { key: 'skin_flush', label: 'è‚Œè†šæ½®ç´…', data: privateData, icon: 'ğŸ¨' }, { key: 'muscle_tension', label: 'è‚Œè‚‰å¼µåŠ›', data: privateData, icon: 'ğŸ’ª' },
                { key: 'trembling_level', label: 'èº«é«”é¡«æŠ–', data: privateData, icon: 'ğŸŒ€' }, { key: 'breathing_pattern', label: 'å‘¼å¸æ¨¡å¼', data: privateData, icon: 'ğŸŒ¬ï¸' },
                { key: 'stomach', label: 'è…¸èƒƒ', data: privateData, icon: 'ğŸ©' }
            ],
            'ç‰¹æ®Šç³»ç»Ÿ': [
                { key: 'ç‰¡ä¸¹çº¹èº«çŠ¶æ€', label: 'ç‰¡ä¸¹ç´‹èº«', data: bodyData, icon: 'ğŸŒº' }, { key: 'è…°é—´å°è®°çŠ¶æ€', label: 'è…°é–“å°è¨˜', data: bodyData, icon: 'â•‘â–ˆâ•‘' },
                { key: 'nanomachine_activity', label: 'ç´ç±³æ©Ÿæ´»æ€§', data: nanoData, icon: 'âš™ï¸' }, { key: 'regeneration_speed', label: 'å†ç”Ÿé€Ÿåº¦', data: nanoData, icon: 'âš¡' },
                { key: 'period', label: 'ç»æœŸçŠ¶æ€', data: privateData, icon: 'ğŸ“…' }, { key: 'fertility', label: 'å—å­•å¯èƒ½', data: privateData, icon: 'ğŸ§¬' },
                { key: 'lactation_status', label: 'æ³Œä¹³çŠ¶æ€', data: privateData, icon: 'ğŸ¥›' }, { key: 'pregnancy_status', label: 'å¦Šå¨ çŠ¶æ€', data: privateData, icon: 'ğŸ¤°' }
            ]
        };
        
        let pagerBtns = '';
        let pagerContent = '';
        let isFirstPage = true;

        for (const pageName in pages) {
            pagerBtns += `<button class="secrets-pager-btn ${isFirstPage ? 'active' : ''}" data-page="${pageName}">${pageName}</button>`;
            let pageItems = '';
            pages[pageName].forEach(item => {
                const label = item.label || item.key;
                const value = safeGet(item.data, `${item.key}[0]`);
                pageItems += `<div class="property-item"><span class="property-label">${item.icon} ${label}</span><span class="property-value">${value}</span></div>`;
            });

            pagerContent += `<div class="secrets-page ${isFirstPage ? 'active' : ''}" id="page-${pageName}"><div class="property-grid grid-col-2">${pageItems}</div></div>`;
            isFirstPage = false;
        }

        const finalHtml = `<div class="secrets-pager">${pagerBtns}</div><div class="secrets-content-wrapper">${pagerContent}</div>`;
        $container.html(finalHtml);
    }

    function renderRelationsTab(data, $container) { const relationData = _.get(data, 'å…³ç³»', {}); const userRelation = _.get(relationData, 'ä¸ä¸»äººçš„å…³ç³»', {}); const pastRelation = _.get(relationData, 'ä¸æ—é›¨æ™´çš„è®°å¿†', {}); const relationsHtml = `<div class="section-title">ä¸ä¸»äººçš„ç¾ç»Š</div><div class="relation-card"><div class="relation-item"><span class="property-label">å¥½æ„Ÿåº¦</span><span class="relation-value infinity">âˆ</span></div>${createProgressBar('ä¾èµ–åº¦', safeGet(userRelation, 'ä¾èµ–åº¦[0]', 0), 0, 100)}<div class="relation-item" style="margin-top: 10px;"><span class="property-label">ä¸»å¯¼æƒ</span><span class="property-value persona-value">${safeGet(userRelation, 'ä¸»å¯¼æƒ[0]')}</span></div></div><div class="section-title">ä¸è¿‡å»çš„è¿æ¥</div><div class="relation-card">${createProgressBar('è®°å¿†èåˆåº¦', safeGet(pastRelation, 'è®°å¿†èåˆåº¦[0]', 0), 0, 100)}<div class="relation-item full-width" style="margin-top: 10px;"><span class="property-label">å½“å‰å½±å“:</span><span class="property-value" style="margin-top: 5px;">${safeGet(pastRelation, 'å½“å‰å½±å“[0]')}</span></div></div>`; $container.html(relationsHtml); }
    function renderWishesTab(data, $container) { const wishes = safeGet(data, 'ç‰é‡‘ä¹‹å¿ƒ.æ„¿æœ›æ¸…å•[0]', []); const progress = _.get(data, 'æ„¿æœ›è¿›åº¦', {}); let wishesHtml = `<div class="section-title">ä¸»äººçš„æ„¿æœ›æ¸…å•</div>`; if (Array.isArray(wishes) && wishes.length > 0) { wishes.forEach(wish => { const wishName = typeof wish === 'string' ? wish.replace('ã€å­¦ä¹ ä¸­ã€‘', '') : 'æœªçŸ¥æ„¿æœ›'; const progressValue = safeGet(progress, `${wishName}[0]`, 0); wishesHtml += `<div class="wish-item"><div class="wish-header"><span class="wish-text">${wish}</span><span class="wish-progress-text">${progressValue}%</span></div><div class="progress-bar-container"><div class="progress-bar" style="width: ${progressValue}%;"></div></div></div>`; }); } else { wishesHtml += `<div class="empty-wish-text">å½“å‰æ²¡æœ‰éœ€è¦å®ç°çš„æ„¿æœ›ã€‚</div>`; } wishesHtml += `<div class="whisper-box" style="margin-top: 20px;">é€šè¿‡[è®¸æ„¿ï¼šxxx]æŒ‡ä»¤æ¥æ·»åŠ æ–°çš„æ„¿æœ›ã€‚</div>`; $container.html(wishesHtml); }
    function renderMemoriesTab(data, $container) { const flags = _.get(data, 'äº‹ä»¶æ——å¸œ', {}); const memoryList = [ { flag: 'å›å¿†_ç«¥å¹´é›¨å¤©', title: 'ç«¥å¹´é›¨å¤©', icon: 'ğŸŒ§ï¸', desc: 'å…³äºé›¨å¤©ã€ææƒ§ä¸ä¸€ä¸ªæ¸©æš–çš„æ€€æŠ±ã€‚' }, { flag: 'å›å¿†_åå­—çš„æ„ä¹‰', title: 'åå­—çš„æ„ä¹‰', icon: 'ğŸ“œ', desc: 'â€œæ„¿ä½ çš„çµé­‚å¦‚ç‰ç’ƒèˆ¬çº¯å‡€ï¼Œç”Ÿå‘½å¦‚é»„é‡‘èˆ¬ç’€ç’¨ã€‚â€' }, { flag: 'å›å¿†_æ¯äº²çš„èœ', title: 'æ¯äº²çš„èœ', icon: 'ğŸ²', desc: 'ä¸€é“æ—¢ç†Ÿæ‚‰åˆé™Œç”Ÿçš„ã€åˆ»åœ¨çµé­‚æ·±å¤„çš„å®¶å¸¸èœå‘³é“ã€‚' }, ]; let memoriesHtml = `<div class="section-title">è®°å¿†ç¢ç‰‡</div><div class="memory-grid">`; memoryList.forEach(mem => { const isUnlocked = safeGet(flags, `${mem.flag}[0]`, false); memoriesHtml += `<div class="memory-fragment ${isUnlocked ? 'unlocked' : 'locked'}"'><div class="fragment-icon">${isUnlocked ? mem.icon : 'â“'}</div><div class="fragment-title">${mem.title}</div><div class="property-value" style="text-align:left; word-break:break-word;">${isUnlocked ? mem.desc : 'è®°å¿†è¢«å°é”ä¸­...'}</div></div>`; }); memoriesHtml += `</div><div class="whisper-box" style="margin-top: 20px;">é€šè¿‡ç‰¹å®šçš„å¯¹è¯å’Œäº’åŠ¨ï¼Œå¯ä»¥å”¤é†’ç‰é‡‘è¢«å°˜å°çš„è®°å¿†ã€‚</div>`; $container.html(memoriesHtml); }
    function renderDominionTab(data, $container) { const dominionData = _.get(data, 'æ”¯é…çŠ¶æ€', {}); const currentMode = safeGet(dominionData, 'å½“å‰æ¨¡å¼[0]', 'è‡ªä¸»'); const modes = ['è‡ªä¸»', 'æŒ‡ä»¤æ‰§è¡Œ', 'æ·±åº¦æ²‰ç¡', 'è®¤çŸ¥æ‰­æ›²', 'äººå¶åŒ–']; let radioButtons = ''; modes.forEach(mode => { const isChecked = mode === currentMode ? 'checked' : ''; radioButtons += `<label><input type="radio" name="dominion-mode" value="${mode}" ${isChecked}> ${mode}</label>`; }); const dominionHtml = `<div class="section-title">æ”¯é…æ¨¡å¼æ§åˆ¶</div><div class="dominion-warning" style="display: ${currentMode === 'è‡ªä¸»' ? 'none' : 'flex'}">âš ï¸ å½“å‰å¤„äºéè‡ªä¸»æ¨¡å¼ï¼Œäººæ ¼ä¸è¡Œä¸ºå¯èƒ½è¢«è¦†ç›–ã€‚</div><div class="control-description">é€‰æ‹©ä»¥è¦†ç›–ç‰é‡‘çš„å½“å‰çŠ¶æ€ã€‚æ­¤æ“ä½œå°†ç”ŸæˆæŒ‡ä»¤ï¼Œè¯·åœ¨èŠå¤©æ¡†å‘é€ä»¥ç”Ÿæ•ˆã€‚</div><div class="dominion-control-group" id="dominion-mode-selector">${radioButtons}</div><div class="section-title">æ¨¡å¼æè¿°</div><div class="whisper-box">${safeGet(dominionData, 'æ¨¡å¼æè¿°[0]', '...')}</div>`; $container.html(dominionHtml); }
    
    function bindEvents() { 
        const $document = $(document);
        $document.off('click.ryukinTabs').on('click.ryukinTabs', '.tab-btn', function() { 
            const $this = $(this);
            if($this.hasClass('active')) return; 
            $('.tab-btn').removeClass('active'); 
            $this.addClass('active'); 
            const target = $this.data('target'); 
            $('.tab-content').removeClass('active'); 
            $('#' + target).addClass('active'); 
        }); 
        $document.off('click.ryukinPager').on('click.ryukinPager', '.secrets-pager-btn', function() {
            const $this = $(this);
            if ($this.hasClass('active')) return;
            $('.secrets-pager-btn').removeClass('active');
            $this.addClass('active');
            const pageId = '#page-' + $this.data('page');
            $('.secrets-page').removeClass('active');
            $(pageId).addClass('active');
        });
        $document.off('change.ryukinDominion').on('change.ryukinDominion', 'input[name="dominion-mode"]', function() { 
            const selectedMode = $(this).val(); 
            const command = `[æŒ‡ä»¤ï¼šåˆ‡æ¢æ”¯é…æ¨¡å¼ä¸ºâ€œ${selectedMode}â€]` ; 
            prompt('æŒ‡ä»¤å·²ç”Ÿæˆï¼è¯·å¤åˆ¶ä»¥ä¸‹å…¨éƒ¨æŒ‡ä»¤ï¼Œå¹¶åœ¨èŠå¤©æ¡†ä¸­å‘é€ä»¥ç”Ÿæ•ˆï¼š', command); 
        }); 
        $document.off('rerender-state-bar.ryukinCore').on('rerender-state-bar.ryukinCore', init); 
    }

    $(() => { errorCatched(init)(); });
  </script>
</body>